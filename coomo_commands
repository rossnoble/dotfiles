# CooMo Development Helpers Commands

alias coomosql="mysql --user=root --password=rocksauce --host=127.0.0.1 --port=3307"

TEST_ARGS=""

# Run for a service by name
function gotest() {
  if [ $1 ]; then
    local testpath="./services/${1}"
    local testargs="-args --mysql-host=localhost:3307 --mysql-root-password=rocksauce"
    local verbose=""

    if [[ $* == *-v* ]]; then
      verbose="-v"
    fi

    if [[ $* == *-nokube* ]]; then
      testargs=""
    fi

    # go test -p 1 -v $testpath -bench=. -benchmem -run "${2}" -args --mysql-host=localhost:3307 --mysql-root-password=rocksauce
    if [ $2 ]; then
      go test -p 1 $verbose $testpath -bench=. -benchmem -run "${2}" $testargs
    else
      go test -p 1 $verbose $testpath -bench=. -benchmem $testargs
    fi
  else
    ./scripts/development/run-tests.sh
  fi
}

function cm_start() {
  ./scripts/development/start-minikube.sh
  ./scripts/development/build-services.sh
  ./scripts/development/run-services.sh
}

function cm_rebuild() {
  ./scripts/development/service-dev.sh $1
}

function cm_build() {
  ./scripts/development/build-services.sh $1
}

function cm_stop() {
  ./scripts/development/stop-services.sh $1
}

function cm_migrate_down_up() {
  ./scripts/development/run-migrations.sh down $1
  ./scripts/development/run-migrations.sh up $1
}

function cm_start_minikube() {
  ./scripts/development/start-minikube.sh
  eval $(minikube docker-env)
}

function cm_restart_minikube() {
  ./scripts/development/stop-minikube.sh
  ./scripts/development/start-minikube.sh
}

function cm_stop_minikube() {
  ./scripts/development/stop-minikube.sh
}
